/**
* Name: PiroBox Extended v.1.0
* Date: Gen 2011
* Autor: Diego Valobra (http://www.pirolab.it),(http://www.diegovalobra.com)
* Version: 1.0
* Licence: CC-BY-SA http://creativecommons.org/licenses/by-sa/3/it/
**/
(function(e){e.fn.piroBox_ext=function(t){function N(){e(window).scroll(function(){var t=e(window).height();var n=e(window).width();var r=l.height();var i=l.width();l.css({left:n/2-i/2+"px",top:parseInt(e(document).scrollTop())+(t-r)/2})})}function C(){if(e(".piro_close").is(":visible")){e(".my_frame").remove();l.add(y).add(w).stop();var t=l;if(false){t=y.add(h);e(".div_reg img").remove()}else{t=l.add(h)}t.piroFadeOut(200,function(){y.html("");b.add(c).add(E).hide();e(".nav_container").hide();h.add(l).hide().css("visibility","visible")})}}t=jQuery.extend({piro_speed:700,bg_alpha:.9,piro_scroll:true},t);e.fn.piroFadeIn=function(t,n){e(this).fadeIn(t,function(){if(false)e(this).get(0).style.removeAttribute("filter");if(n!=undefined)n()})};e.fn.piroFadeOut=function(t,n){e(this).fadeOut(t,function(){if(false)e(this).get(0).style.removeAttribute("filter");if(n!=undefined)n()})};var n=e('a[class*="pirobox"]');var r=new Object;for(var i=0;i<n.length;i++){var s=e(n[i]);r["a."+s.attr("class").match(/^pirobox_gall\w*/)]=0}var o=new Array;for(var u in r){o.push(u)}for(var i=0;i<o.length;i++){e(o[i]+":first").addClass("first");e(o[i]+":last").addClass("last")}var a=e(n);e('a[class*="pirobox_gall"]').each(function(e){this.rev=e+0});var f='<div class="piro_overlay"></div>'+'<table class="piro_html"  cellpadding="0" cellspacing="0">'+"<tr>"+'<td class="h_t_l"></td>'+'<td class="h_t_c" title="drag me!!"></td>'+'<td class="h_t_r"></td>'+"</tr>"+"<tr>"+'<td class="h_c_l"></td>'+'<td class="h_c_c">'+'<div class="piro_loader" title="close"><span></span></div>'+'<div class="resize">'+'<div class="nav_container">'+'<a href="#prev" class="piro_prev" title="previous"></a>'+'<a href="#next" class="piro_next" title="next"></a>'+'<div class="piro_prev_fake">prev</div>'+'<div class="piro_next_fake">next</div>'+'<div class="piro_close" title="close"></div>'+"</div>"+'<div class="caption"></div>'+'<div class="div_reg"></div>'+"</div>"+"</td>"+'<td class="h_c_r"></td>'+"</tr>"+"<tr>"+'<td class="h_b_l"></td>'+'<td class="h_b_c"></td>'+'<td class="h_b_r"></td>'+"</tr>"+"</table>";e("body").append(f);var l=e(".piro_html"),c=e(".caption"),h=e(".piro_overlay"),p=e(".piro_next"),d=e(".piro_prev"),v=e(".piro_next_fake"),m=e(".piro_prev_fake"),g=e(".piro_close"),y=e(".div_reg"),b=e(".piro_loader"),w=e(".resize"),E=e(".btn_info");var S=.95;if(false){l.draggable({handle:".h_t_c,.h_b_c,.div_reg img"})}else{l.draggable({handle:".h_t_c,.h_b_c,.div_reg img",opacity:.8})}var x=e(window).height();var T=e(window).width();e(".nav_container").hide();l.css({left:T/2-250+"px",top:parseInt(e(document).scrollTop())+100});e(l).add(c).add(h).hide();h.css({opacity:t.bg_alpha});e(d).add(p).bind("click",function(t){e(".nav_container").hide();t.preventDefault();p.add(d).hide();var n=parseInt(e('a[class*="pirobox_gall"]').filter(".item").attr("rev"));var r=e(this).is(".piro_prev")?e('a[class*="pirobox_gall"]').eq(n-1):e('a[class*="pirobox_gall"]').eq(n+1);r.click()});e("html").bind("keyup",function(t){if(t.keyCode==27){t.preventDefault();if(e(g).is(":visible")){C()}}});e("html").bind("keyup",function(t){if(e(".item").is(".first")){}else if(t.keyCode==37){t.preventDefault();if(e(g).is(":visible")){d.click()}}});e("html").bind("keyup",function(t){if(e(".item").is(".last")){}else if(t.keyCode==39){t.preventDefault();if(e(g).is(":visible")){p.click()}}});e(window).resize(function(){var t=e(window).height();var n=e(window).width();var r=l.height();var i=l.width();l.css({left:n/2-i/2+"px",top:parseInt(e(document).scrollTop())+(t-r)/2})});if(t.piro_scroll==true){N()}e(a).each(function(){function s(){function s(){if(r[1]=="full"&&r[2]=="full"){r[2]=e(window).height()-70;r[1]=e(window).width()-55}var n=e(window).height();var i=e(window).width();g.hide();y.add(w).animate({height:+r[2]+"px",width:+r[1]+"px"},t.piro_speed).css("visibility","visible");l.animate({height:+r[2]+20+"px",width:+r[1]+20+"px",left:i/2-(r[1]/2+10)+"px",top:parseInt(e(document).scrollTop())+(n-r[2])/2-10},t.piro_speed,function(){p.add(d).css({height:"20px",width:"20px"});p.add(d).add(m).add(v).css("visibility","visible");e(".nav_container").show();g.show()})}function o(){var n=new Image;n.onerror=function(){c.html("");n.src="http://www.pirolab.it/pirobox/js/error.jpg"};n.onload=function(){c.add(E).hide();var r=e(window).height();var i=e(window).width();var s=n.height;var o=n.width;if(s+20>r||o+20>i){var u=(o+20)/i;var a=(s+20)/r;if(a>u){o=Math.round(n.width*(S/a));s=Math.round(n.height*(S/a))}else{o=Math.round(n.width*(S/u));s=Math.round(n.height*(S/u))}}else{s=n.height;o=n.width}var r=e(window).height();var i=e(window).width();e(n).height(s).width(o).hide();e(n).fadeOut(300,function(){});e(".div_reg img").remove();e(".div_reg").html("");y.append(n).show();e(n).addClass("immagine");y.add(w).animate({height:s+"px",width:o+"px"},t.piro_speed);l.animate({height:s+20+"px",width:o+20+"px",left:i/2-(o+20)/2+"px",top:parseInt(e(document).scrollTop())+(r-s)/2-20},t.piro_speed,function(){var t=w.width();c.css({width:t+"px"});b.hide();e(n).fadeIn(300,function(){g.add(E).show();c.slideDown(200);p.add(d).css({height:"20px",width:"20px"});p.add(d).add(m).add(v).css("visibility","visible");e(".nav_container").show();w.resize(function(){NimgW=n.width;NimgH=n.heigh;c.css({width:NimgW+"px"})})})})};n.src=i;b.click(function(){n.src="about:blank"})}l.add(h).add(y).add(b).show();switch(r[0]){case"iframe":y.html("").css("overflow","hidden");w.css("overflow","hidden");g.add(E).add(c).hide();s();y.piroFadeIn(300,function(){y.append('<iframe id="my_frame" class="my_frame" src="'+i+'" frameborder="0" allowtransparency="true" scrolling="auto" align="top"></iframe>');e(".my_frame").css({height:+r[2]+"px",width:+r[1]+"px"});b.hide()});break;case"content":y.html("").css("overflow","auto");w.css("overflow","auto");e(".my_frame").remove();g.add(E).add(c).hide();s();y.piroFadeIn(300,function(){y.load(i);b.hide()});break;case"inline":y.html("").css("overflow","auto");w.css("overflow","auto");e(".my_frame").remove();g.add(E).add(c).hide();s();y.piroFadeIn(300,function(){e(i).clone(true).appendTo(y).piroFadeIn(300);b.hide()});break;case"gallery":y.css("overflow","hidden");w.css("overflow","hidden");e(".my_frame").remove();g.add(E).add(c).hide();if(n==""){c.html("")}else{c.html("<p>"+n+"</p>")}o();break;case"single":g.add(E).add(c).hide();y.html("").css("overflow","hidden");w.css("overflow","hidden");e(".my_frame").remove();if(n==""){c.html("")}else{c.html("<p>"+n+"</p>")}o();break}}var n=e(this).attr("title");var r=e(this).attr("rel").split("-");var i=e(this).attr("href");e(this).unbind();e(this).bind("click",function(n){h.css({opacity:t.bg_alpha});n.preventDefault();p.add(d).hide().css("visibility","hidden");e(a).filter(".item").removeClass("item");e(this).addClass("item");s();if(e(this).is(".first")){d.hide();p.show();m.show().css({opacity:.5,visibility:"hidden"})}else{p.add(d).show();v.add(m).hide()}if(e(this).is(".last")){d.show();v.show().css({opacity:.5,visibility:"hidden"});p.hide()}if(e(this).is(".pirobox")){p.add(d).hide()}})});g.add(b).add(h).bind("click",function(e){e.preventDefault();C()})}})(jQuery)